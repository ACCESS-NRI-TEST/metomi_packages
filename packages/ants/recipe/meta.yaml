{% set name = "ants" %}
{% set version = os.environ.get('VERSION') %}

package:
  name: "{{ name|lower }}"
  version: {{ version }}

source:
  svn_url: https://code.metoffice.gov.uk/svn/ancil/ants/tags/{{ version }}
  svn_rev: {{ environ["REVISION"] }}

build:
  number: 0
  skip: true # [not linux64]

requirements:
  host:
    - python
    - setuptools
  run:
    - python
    - numpy<2
    - cartopy
    - dask
    - esmpy
    - f90nml
    - gdal
    - mule-base
    - numba
    - pykdtree
    - python-stratify
    - scitools-iris=3.7.1
    - um-spiral-search

test:
  source_files:
    - lib/ants/tests/resources
    - lib/ants/tests/results
  requires:
    - mule-utils
    - pytest
  imports:
    - ants
  commands:
    - ancil_2anc.py -h
    - ancil_create_shapefile.py -h
    - ancil_fill_n_merge.py -h
    - ancil_general_regrid.py -h
    - ants-version
    # Enable ants to find the proper test resources and results
    - ln -vs ${SRC_DIR}/lib/ants/tests/resources ${SP_DIR}/ants/tests/resources
    - ln -vs ${SRC_DIR}/lib/ants/tests/results ${SP_DIR}/ants/tests/results
    # Run the tests:
    # - ignoring testing for deprecation warnings log
    # - not testing the 'test_point_lie_beyond_crs_definition' function (there is an issue with this test)
    - $PYTHON -m pytest -W default -vs ${SP_DIR}/ants/tests --ignore ${SP_DIR}/ants/tests/fileformats/test_deprecation_warnings.py -k 'not test_point_lie_beyond_crs_definition'

about:
  home: https://code.metoffice.gov.uk/doc/ancil/ants/latest/index.html
  license: BSD
  license_family: BSD
  summary: ANTS is a versatile Python library for developing ancillary applications.